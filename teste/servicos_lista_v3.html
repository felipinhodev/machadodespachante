{% extends "base.html" %}

{% block title %}Lista de ServiÃ§os | Despachante Machado{% endblock %}

{% block content %}
<style>
Â  Â  /* Estilos para badges de status (reaproveitando do status_servico.html) */
Â  Â  .status-badge { 
Â  Â  Â  Â  font-weight: bold; 
Â  Â  Â  Â  border-radius: 4px; 
Â  Â  Â  Â  padding: 4px 8px; 
Â  Â  Â  Â  display: inline-block; 
Â  Â  Â  Â  font-size: 0.85em; 
Â  Â  Â  Â  text-transform: uppercase; 
Â  Â  }
Â  Â  .status-pendente { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
Â  Â  .status-em-andamento { background-color: #cfe2ff; color: #07387f; border: 1px solid #b8daff; }
Â  Â  .status-concluido { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
Â  Â  .status-cancelado { background-color: #e9ecef; color: #495057; border: 1px solid #c6c8ca; }
Â  Â  
Â  Â  .table-responsive {
Â  Â  Â  Â  overflow-x: auto;
Â  Â  }
Â  Â  .table-servicos {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â  .table-servicos th, .table-servicos td {
Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  vertical-align: middle;
Â  Â  }
Â  Â  .action-buttons a {
Â  Â  Â  Â  margin-right: 5px;
Â  Â  }
</style>

<h2>ðŸ“‹ Lista de ServiÃ§os</h2>
<p>VisÃ£o geral de todos os serviÃ§os registrados e seus status atuais.</p>

{% with messages = get_flashed_messages(with_categories=true) %}
Â  Â  {% if messages %}
Â  Â  Â  Â  {% for category, message in messages %}
Â  Â  Â  Â  Â  Â  <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
Â  Â  Â  Â  Â  Â  Â  Â  {{ message }}
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  {% endfor %}
Â  Â  {% endif %}
{% endwith %}

<div style="margin-bottom: 20px;">
Â  Â  <a href="{{ url_for('servicos_cadastro_v3') }}" class="btn btn-primary">
Â  Â  Â  Â  <i class="fas fa-plus"></i> Novo ServiÃ§o
Â  Â  </a>
Â  Â  <a href="{{ url_for('servicos_filtros') }}" class="btn btn-secondary">
Â  Â  Â  Â  <i class="fas fa-filter"></i> Filtrar/Buscar
Â  Â  </a>
</div>

<div class="table-responsive">
Â  Â  <table class="table table-striped table-servicos">
Â  Â  Â  Â  <thead class="table-light">
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <th>ID</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Cliente</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Tipo</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Valor Total</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Valor Pago</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Saldo Pendente</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Status</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th>Data InÃ­cio</th>
Â  Â  Â  Â  Â  Â  Â  Â  <th style="text-align: center;">AÃ§Ãµes</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  {% if servicos_lista %}
Â  Â  Â  Â  Â  Â  Â  Â  {% for servico in servicos_lista %}
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>#{{ servico.id }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ servico.cliente.nome }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ servico.tipo_servico }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ servico.valor_total | moeda }}</td> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ servico.valor_pago | moeda }}</td> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set saldo = servico.valor_total - servico.valor_pago %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="font-weight: 600; color: {% if saldo > 0 %}var(--cor-erro){% else %}var(--cor-secundaria){% endif %};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ saldo | moeda }} Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set status_class = servico.status_processo.lower().replace(' ', '-') %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="status-badge status-{{ status_class }}">{{ servico.status_processo }}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ servico.data_entrada | default('N/A') }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="action-buttons text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="{{ url_for('processar_pagamento', servico_id=servico.id) }}" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="btn btn-sm btn-success" title="Registrar Pagamento">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-money-bill-wave"></i> Pagar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="{{ url_for('atualizar_status_servico', servico_id=servico.id) }}" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="btn btn-sm btn-info" title="Mudar Status/Placa">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-tasks"></i> Status
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  <td colspan="9" class="text-center">Nenhum serviÃ§o encontrado.</td>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
</div>

{% endblock %}